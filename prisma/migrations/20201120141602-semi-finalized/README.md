# Migration `20201120141602-semi-finalized`

This migration has been generated by prantaDutta at 11/20/2020, 8:16:02 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "borrowers" DROP CONSTRAINT "borrowers_userid_foreign"

ALTER TABLE "lenders" DROP CONSTRAINT "lenders_userid_foreign"

ALTER TABLE "loans" DROP CONSTRAINT "loans_borrowerid_foreign"

ALTER TABLE "loans" DROP CONSTRAINT "loans_lenderid_foreign"

ALTER TABLE "loans" DROP CONSTRAINT "loans_userid_foreign"

ALTER TABLE "password_resets" DROP CONSTRAINT "password_resets_userid_foreign"

ALTER TABLE "penalties" DROP CONSTRAINT "penalties_loanid_foreign"

ALTER TABLE "penalties" DROP CONSTRAINT "penalties_userid_foreign"

ALTER TABLE "wallets" DROP CONSTRAINT "wallets_loanid_foreign"

ALTER TABLE "wallets" DROP CONSTRAINT "wallets_userid_foreign"

ALTER TABLE "borrowers" DROP CONSTRAINT "borrowers_pkey",
ALTER COLUMN "id" SET DATA TYPE INTEGER,
ALTER COLUMN "userId" SET DATA TYPE INTEGER,
ADD PRIMARY KEY ("id")

ALTER TABLE "lenders" DROP CONSTRAINT "lenders_pkey",
ALTER COLUMN "id" SET DATA TYPE INTEGER,
ALTER COLUMN "userId" SET DATA TYPE INTEGER,
ADD PRIMARY KEY ("id")

ALTER TABLE "loans" DROP CONSTRAINT "loans_pkey",
ALTER COLUMN "id" SET DATA TYPE INTEGER,
ALTER COLUMN "lenderId" SET DATA TYPE INTEGER,
ALTER COLUMN "borrowerId" SET DATA TYPE INTEGER,
ALTER COLUMN "userId" SET DATA TYPE INTEGER,
ALTER COLUMN "amount" SET DATA TYPE INTEGER,
ALTER COLUMN "amountWithInterest" SET DATA TYPE INTEGER,
ALTER COLUMN "amountWithInterestAndCompanyFees" SET DATA TYPE INTEGER,
ALTER COLUMN "monthlyInstallment" SET DATA TYPE INTEGER,
ADD PRIMARY KEY ("id")

ALTER TABLE "password_resets" DROP CONSTRAINT "password_resets_pkey",
ALTER COLUMN "id" SET DATA TYPE INTEGER,
ALTER COLUMN "userId" SET DATA TYPE INTEGER,
ADD PRIMARY KEY ("id")

ALTER TABLE "penalties" DROP CONSTRAINT "penalties_pkey",
ALTER COLUMN "id" SET DATA TYPE INTEGER,
ALTER COLUMN "userId" SET DATA TYPE INTEGER,
ALTER COLUMN "loanId" SET DATA TYPE INTEGER,
ADD PRIMARY KEY ("id")

ALTER TABLE "users" DROP CONSTRAINT "users_pkey",
ALTER COLUMN "id" SET DATA TYPE INTEGER,
ALTER COLUMN "role" SET DATA TYPE "Role",
ADD PRIMARY KEY ("id")

ALTER TABLE "wallets" DROP CONSTRAINT "wallets_pkey",
ALTER COLUMN "id" SET DATA TYPE INTEGER,
ALTER COLUMN "userId" SET DATA TYPE INTEGER,
ALTER COLUMN "loanId" SET DATA TYPE INTEGER,
ALTER COLUMN "balance" SET DATA TYPE INTEGER,
ADD PRIMARY KEY ("id")

DROP TABLE "failed_jobs"

DROP TABLE "migrations"

ALTER TABLE "borrowers" ADD FOREIGN KEY("userId")REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "lenders" ADD FOREIGN KEY("userId")REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "loans" ADD FOREIGN KEY("borrowerId")REFERENCES "borrowers"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "loans" ADD FOREIGN KEY("lenderId")REFERENCES "lenders"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "loans" ADD FOREIGN KEY("userId")REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "password_resets" ADD FOREIGN KEY("userId")REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "penalties" ADD FOREIGN KEY("loanId")REFERENCES "loans"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "penalties" ADD FOREIGN KEY("userId")REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "wallets" ADD FOREIGN KEY("loanId")REFERENCES "loans"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "wallets" ADD FOREIGN KEY("userId")REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER INDEX "users_email_unique" RENAME TO "users.email_unique"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201116062133-init..20201120141602-semi-finalized
--- datamodel.dml
+++ datamodel.dml
@@ -1,27 +1,114 @@
-// This is your Prisma schema file,
-// learn more about it in the docs: https://pris.ly/d/prisma-schema
+generator client {
+  provider = "prisma-client-js"
+}
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
-generator client {
-  provider = "prisma-client-js"
+model borrowers {
+  id         Int       @id @default(autoincrement())
+  userId     Int
+  created_at DateTime?
+  updated_at DateTime?
+  users      users     @relation(fields: [userId], references: [id])
+  loans      loans[]
 }
+model lenders {
+  id         Int       @id @default(autoincrement())
+  userId     Int
+  created_at DateTime?
+  updated_at DateTime?
+  users      users     @relation(fields: [userId], references: [id])
+  loans      loans[]
+}
+
+model loans {
+  id                               Int         @id @default(autoincrement())
+  lenderIds                        Json
+  lenderId                         Int
+  borrowerId                       Int
+  userId                           Int
+  loanMode                         String
+  loanDuration                     String
+  amount                           Int
+  interestRate                     Int
+  amountWithInterest               Int
+  companyFees                      Int
+  amountWithInterestAndCompanyFees Int
+  monthlyInstallment               Int
+  loanStartDate                    DateTime
+  loanEndDate                      DateTime
+  created_at                       DateTime?
+  updated_at                       DateTime?
+  borrowers                        borrowers   @relation(fields: [borrowerId], references: [id])
+  lenders                          lenders     @relation(fields: [lenderId], references: [id])
+  users                            users       @relation(fields: [userId], references: [id])
+  penalties                        penalties[]
+  wallets                          wallets[]
+}
+
+model penalties {
+  id            Int       @id @default(autoincrement())
+  userId        Int
+  loanId        Int
+  month         String
+  year          String
+  penaltyAmount Int
+  created_at    DateTime?
+  updated_at    DateTime?
+  loans         loans     @relation(fields: [loanId], references: [id])
+  users         users     @relation(fields: [userId], references: [id])
+}
+
+model users {
+  id                 Int               @id @default(autoincrement())
+  name               String
+  email              String            @unique
+  emailVerifiedAt    DateTime?
+  password           String
+  role               Role
+  verified           Boolean           @default(false)
+  verificationNo     String?
+  verificationPhotos Json
+  remember_token     String?
+  created_at         DateTime?
+  updated_at         DateTime?
+  borrowers          borrowers[]
+  lenders            lenders[]
+  loans              loans[]
+  password_resets    password_resets[]
+  penalties          penalties[]
+  wallets            wallets[]
+}
+
+model wallets {
+  id         Int       @id @default(autoincrement())
+  userId     Int
+  loanId     Int
+  balance    Int
+  type       String
+  created_at DateTime?
+  updated_at DateTime?
+  loans      loans     @relation(fields: [loanId], references: [id])
+  users      users     @relation(fields: [userId], references: [id])
+}
+
+model password_resets {
+  id         Int       @id @default(autoincrement())
+  userId     Int
+  email      String
+  token      String
+  created_at DateTime?
+  users      users     @relation(fields: [userId], references: [id])
+
+  @@index([email], name: "password_resets_email_index")
+}
+
 enum Role {
   Admin
   Borrower
   Lender
 }
-
-model User {
-  id        Int      @id @default(autoincrement())
-  email     String   @unique
-  name      String
-  role      Role
-  password  String
-  createdAt DateTime @default(now())
-  updatedAt DateTime @updatedAt
-}
```


